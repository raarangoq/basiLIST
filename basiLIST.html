<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>BasiLIST</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
	<script type="text/javascript" src="js/phaser.js"></script>

	<script type="text/javascript" src="js/orb.js"></script>
	<script type="text/javascript" src="js/attack.js"></script>
	<script type="text/javascript" src="js/player.js"></script>
	<script type="text/javascript" src="js/snake.js"></script>

	<script type="text/javascript" src="js/GUI/gui.js"></script>
	<script type="text/javascript" src="js/GUI/health_bar.js"></script>


	<script type="text/javascript" src="js/level1.js"></script>
	<script type="text/javascript" src="js/input.js"></script>
	
	

    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

// Se especifica el tamaño de ventana de 800x600
var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });

// Variables para controlar la entrada por teclado
var keyboard;



// Los objetos del juego
var red_orb;
var player;
//var attack;

var gui;
var level;



var snakeHeads = [];


// fna bfask
var text;
var texta;



function preload() {
	// Cargar ambiente del nivel 1
	game.load.image('ground', 'assets/pics/ground.png');
	game.load.image('footwall', 'assets/pics/footwall.png');
	game.load.image('upperwall', 'assets/pics/upperwall.png');
	game.load.image('lateralwall', 'assets/pics/lateralwall.png');
	game.load.image('lateralwall2', 'assets/pics/lateralwall2.png');
	game.load.spritesheet('fire', 'assets/pics/fire.png', 32, 32);
	game.load.image('pedestal', 'assets/pics/pedestal.png');

	// La imagen del jugador
	game.load.spritesheet('player', 'assets/pics/player.png', 70, 70);

	// Barra de salud del jugador
	game.load.image('healthbar', 'assets/pics/healthbar.png');
	game.load.spritesheet('heart', 'assets/pics/heart.png', 14, 16);

	// Los items del juego
	game.load.spritesheet('redorb', 'assets/pics/redorb.png', 24, 32);

	// La serpiente principal
	game.load.spritesheet('snake', 'assets/pics/snake.png', 50, 50);

	// El ataque del jugador
	game.load.spritesheet('attack','assets/pics/attackzone.png', 30, 30);
}


function create() {

	addLevel();
	addKeyboard();
	// Pueden existir varios orbes al mismo tiempo
	red_orb = addOrb();
	// El jugador
	addPlayer();


text = game.add.text(20, 20, 'inicio', { fontSize: '32px', fill: '#000'});
text.fixedToCamera = true;
texta = game.add.text(20, 60, 'inicio', { fontSize: '32px', fill: '#000'});
texta.fixedToCamera = true;

	// Se agrega la primer serpiente
	snakeHeads[0] = addSnakeSegment('');
	snakeHeads[0].addSegment();

	snakeHeads[1] = addSnakeSegment('');
	snakeHeads[1].addSegment();


	// Las interfaces del juego
	gui = new GUI();
	gui.updateHealthBar(player.health);

	game.camera.follow(player); // La camara del juego seguirá al jugador

text.text = "cargando...";
}



function update() {

	// Las colisiones del juego
	game.physics.arcade.collide(player, level.walls);
	for(var i=0; i<snakeHeads.length; i++){
		collideSnake(snakeHeads[i]);
	}




	// Solapamientos entre objetos
	if(	game.physics.arcade.overlap(player, red_orb) )	{
		player.collectOrbPlayer(red_orb);
		setAllTargetsSnake();
	}
	// Si alguna de las serpientes atrapan algún orbe
	for(var i=0; i<snakeHeads.length; i++){ 
		if( game.physics.arcade.overlap(snakeHeads[i], red_orb) ){
			snakeHeads[i].collectOrbSnake(red_orb);
		}
	}



	player.updatePlayer();
	for(var i=0; i<snakeHeads.length; i++) {
		snakeHeads[i].updateSnake();
	}


}


function collideSnake(segment){
	game.physics.arcade.collide(segment, level.walls);

	// No se debe permitir que el serpiente infrinja daño a un jugador que no puede moverse
	if(player.canMove)
		game.physics.arcade.collide(segment, player, snakeHitsPlayer);
		
	// Cuando el ataque impacta a un segmento de serpiente	
	if(player.is_attacking)
		if( game.physics.arcade.overlap(segment, player.attack) )
			segment.destroySegment();


	if(segment.next != ''){
		collideSnake(segment.next);
	}
}


function snakeHitsPlayer(segment, player){
	player.hitPlayer(segment);
}





function render(){
	
		texta.text = snakeHeads[0].target 
				+ '\n X: ' + snakeHeads[0].target_x
				+ '\n Y: ' + snakeHeads[0].target_y ;

	
}




</script>

</body>
</html>